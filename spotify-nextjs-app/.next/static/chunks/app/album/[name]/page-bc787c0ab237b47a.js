(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[403],{8333:function(t,e,a){Promise.resolve().then(a.bind(a,18))},18:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return v}});var r=a(7437),c=a(2265),s=a(9376),o=a(2983);let n=["https://piped.video","https://piped.kavin.rocks","https://piped.syncpundit.io","https://piped.mha.fi"],l=["https://pipedapi.kavin.rocks","https://pipedapi.syncpundit.io","https://pipedapi.mha.fi","https://pipedapi.tokhmi.xyz"],i=l.map(t=>"".concat(t,"/api/v1"));async function d(t){try{let e=new AbortController,a=setTimeout(()=>e.abort(),5e3),r=await fetch(t,{method:"HEAD",signal:e.signal});return clearTimeout(a),r.ok}catch(t){return!1}}async function u(t){try{var e;let a=t.replace(/[^\w\s-]/g,"").replace(/\s+/g," ").trim(),r="".concat(a," audio");console.log("Searching for:",r);let c=await fetch("/api/piped?q=".concat(encodeURIComponent(r),"&filter=music"));if(!c.ok)throw console.error("API Response not OK:",c.status),Error("Failed to fetch from Piped API");let s=await c.json();if(console.log("Raw search results:",s),!(null===(e=s.items)||void 0===e?void 0:e.length))return console.log("No results found for query:",r),null;let o=s.items.slice(0,5).find(t=>{let e=t.title.toLowerCase();return a.toLowerCase().split(" ").every(t=>e.includes(t))})||s.items[0],n=o.url.split("watch?v=")[1];return console.log("Selected match:",o.title),{title:o.title,url:"".concat("https://piped.video","/watch?v=").concat(n),id:n,duration:o.duration,uploaded:o.uploaded,uploaderName:o.uploaderName,uploaderUrl:o.uploaderUrl,thumbnail:o.thumbnail}}catch(t){return console.error("Piped search error:",t),null}}i[0],(async function(){for(let t of i)if(await d(t))break;for(let t of n)if(await d(t))break})().catch(console.error),l[0];let h="http://localhost:8080";async function m(t){try{let e=await fetch("".concat(h,"/streams/").concat(t));if(!e.ok)throw Error("Failed to get stream URL");let a=(await e.json()).audioStreams.sort((t,e)=>e.bitrate-t.bitrate)[0];return"".concat(h,"/proxy/").concat(encodeURIComponent(a.url))}catch(t){throw console.error("Proxy stream error:",t),t}}async function p(t){try{let e=await fetch("".concat(h,"/search?q=").concat(encodeURIComponent(t),"&filter=music"));if(!e.ok)throw Error("Search failed");return(await e.json()).items}catch(t){return console.error("Search error:",t),[]}}async function f(t,e){try{let a=new URLSearchParams({method:t,api_key:"e540e79e4d0cd99309768db3e9d26789",format:"json",...e}),r=await fetch("".concat("https://ws.audioscrobbler.com/2.0","/?").concat(a),{headers:{Accept:"application/json","User-Agent":"Musish/1.0"}});if(!r.ok)throw Error("LastFM API error: ".concat(r.status));return await r.json()}catch(t){return console.error("Error fetching LastFM metadata:",t),null}}function x(t){let{trackName:e,artist:a,onError:s}=t,o=(0,c.useRef)(null),[n,l]=(0,c.useState)(!1),[i,d]=(0,c.useState)(null),[u,h]=(0,c.useState)(!1),[x,v]=(0,c.useState)(null);(0,c.useEffect)(()=>{(async()=>{h(!0);try{let t=await f("track.getInfo",{track:e,artist:a});t&&v(t);let r=await p("".concat(a," ").concat(e));if(r&&r.length>0){let t=await m(r[0].id);d(t)}}catch(t){console.error("Error initializing track:",t),null==s||s()}finally{h(!1)}})()},[e,a,s]);let y=async()=>{if(o.current&&i)try{n?o.current.pause():await o.current.play(),l(!n)}catch(t){console.error("Playback error:",t),null==s||s()}};return(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("button",{onClick:y,disabled:u||!i,className:"p-2 rounded-full ".concat(u?"bg-gray-500":"bg-[var(--accent-color)]"," text-white hover:scale-105 transition-transform disabled:opacity-50"),children:u?(0,r.jsxs)("svg",{className:"w-6 h-6 animate-spin",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n?(0,r.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})}):(0,r.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M8 5v14l11-7z"})})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"text-[var(--text-primary)] font-medium",children:e}),(0,r.jsx)("div",{className:"text-[var(--text-secondary)] text-sm",children:a})]}),(0,r.jsx)("audio",{ref:o,src:i||void 0,onEnded:()=>l(!1),onError:s})]})}function v(t){let{params:e}=t,[a,n]=(0,c.useState)(null),[l,i]=(0,c.useState)(!0),[d,h]=(0,c.useState)(null),[m,p]=(0,c.useState)(!1),[f,v]=(0,c.useState)(null),[y,g]=(0,c.useState)(!1);(0,s.useRouter)(),(0,c.useEffect)(()=>{(async()=>{try{let t=await fetch("https://ws.audioscrobbler.com/2.0/?method=album.getinfo&album=".concat(e.name,"&api_key=").concat("e540e79e4d0cd99309768db3e9d26789","&format=json")),a=await t.json();n(a.album),i(!1)}catch(t){console.error("Error fetching album:",t),i(!1)}})()},[e.name]);let w=async(t,e)=>{if(!a)return;p(!0);let r="".concat(t.artist," ").concat(t.name," ").concat(a.name);try{let a=await u(r);(null==a?void 0:a.id)?(h(e),v(a.id),g(!0),console.log("Playing track:",{track:t.name,videoTitle:a.title})):console.error("No valid video ID found for:",r)}catch(t){console.error("Error playing track:",t)}finally{p(!1)}};return l?(0,r.jsx)("div",{children:"Loading..."}):a?(0,r.jsxs)("div",{className:"min-h-screen bg-[var(--background-primary)] p-4 md:p-8 pb-24",children:[(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-6 mb-8",children:[(0,r.jsx)("div",{className:"w-full md:w-64 shrink-0",children:(0,r.jsx)(o.J,{src:a.image,alt:a.name,className:"w-full aspect-square rounded-lg shadow-xl"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h1",{className:"text-2xl md:text-4xl font-bold text-[var(--text-primary)] mb-2",children:a.name}),(0,r.jsx)("p",{className:"text-lg text-[var(--text-secondary)] mb-4",children:a.artist}),(0,r.jsxs)("p",{className:"text-sm text-[var(--text-secondary)]",children:[a.tracks.length," songs"]})]})]}),(0,r.jsx)("div",{className:"space-y-2",children:a.tracks.map((t,e)=>(0,r.jsxs)("div",{className:"track-container cursor-pointer hover:bg-[var(--background-tertiary)] ".concat(d===e?"bg-[var(--background-tertiary)]":""),onClick:()=>w(t,e),children:[(0,r.jsx)("span",{className:"track-number",children:m&&d===e?"...":(e+1).toString().padStart(2,"0")}),(0,r.jsx)("div",{className:"track-art",children:(0,r.jsx)(o.J,{src:a.image,alt:a.name,className:"w-full h-full object-cover",priority:e<5})}),(0,r.jsxs)("div",{className:"track-info",children:[(0,r.jsx)("div",{className:"track-title",children:t.name}),t.artist!==a.artist&&(0,r.jsx)("div",{className:"track-artist",children:t.artist})]}),(0,r.jsx)("span",{className:"track-duration",children:"0"===t.duration?"--:--":"".concat(Math.floor(parseInt(t.duration)/60),":").concat((parseInt(t.duration)%60).toString().padStart(2,"0"))})]},e))})]}),(0,r.jsx)(x,{videoId:f,isPlaying:y,onEnded:()=>{null!==d&&d<a.tracks.length-1?w(a.tracks[d+1],d+1):(h(null),v(null),g(!1))},onError:()=>{console.error("Playback error"),g(!1)},trackName:null!==d?a.tracks[d].name:"",artist:null!==d?a.tracks[d].artist:""})]}):(0,r.jsx)("div",{children:"Album not found"})}},2983:function(t,e,a){"use strict";a.d(e,{J:function(){return o}});var r=a(7437),c=a(2265),s=a(3145);let o=t=>{let{src:e,alt:a,className:o="",isArtist:n=!1,priority:l=!1}=t,[i,d]=(0,c.useState)(e),[u,h]=(0,c.useState)(!0),m=n?"/default-artist.png":"/default-album.png";return(0,c.useEffect)(()=>{d(e),h(!0)},[e]),(0,r.jsxs)("div",{className:"relative ".concat(o),children:[(0,r.jsx)(s.default,{src:i,alt:a,width:500,height:500,priority:l,className:"w-full h-full object-cover transition-opacity duration-300 ".concat(u?"opacity-0":"opacity-100"),onLoad:()=>h(!1),onError:()=>{d(m),h(!1)}}),u&&(0,r.jsx)("div",{className:"absolute inset-0 bg-[var(--background-secondary)] animate-pulse rounded-lg"})]})}}},function(t){t.O(0,[785,971,117,744],function(){return t(t.s=8333)}),_N_E=t.O()}]);